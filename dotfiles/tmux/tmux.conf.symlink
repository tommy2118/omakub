# Force vi mode keys if $EDITOR is not explicitly 'vi'
setw -g mode-keys vi

# Set terminal compatibility for 256 colors
set -g default-terminal "screen-256color"
set -sa terminal-overrides ',*256*:Tc'

# Change prefix key to Ctrl-z
unbind C-b
set -g prefix C-z

# Bindings for split panes and navigation
bind z send-keys C-z
bind C-z last-window

bind | split-window -h

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind ` select-window -t 0

# Search for previous error
bind-key e copy-mode \; send-keys "?Error" C-m

# Reduce escape time for more responsive key sequences
set -sg escape-time 0

# Increase scrollback buffer size
set -g history-limit 100000

# Use Up and Down arrows to temporarily maximize the current pane
unbind Up
bind Up resize-pane -Z
unbind Down
bind Down resize-pane -Z

# Copy/paste interoperability
if-shell "uname | grep -q 'Darwin'" 'run-shell "reattach-to-user-namespace -l zsh"'

bind C-c run "tmux show-buffer | (command -v reattach-to-user-namespace &>/dev/null && reattach-to-user-namespace pbcopy || xclip -selection clipboard)"
bind C-v run "(command -v reattach-to-user-namespace &>/dev/null && reattach-to-user-namespace pbpaste || xclip -selection clipboard | tmux load-buffer -) && tmux paste-buffer"

bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy || xclip -selection clipboard'
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi V send-keys -X rectangle-toggle

# Mouse options for tmux >= 2.5
set-option -g -q mouse on

bind-key -T root WheelUpPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
bind-key -T root WheelDownPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; send-keys -M"
bind-key -T copy-mode-vi WheelUpPane send-keys -X halfpage-up
bind-key -T copy-mode-vi WheelDownPane send-keys -X halfpage-down

# Better project name in status bar
set -g status-left-length 18
set -g status-left '#[fg=colour235,bg=colour76,bold] #S '

# Include a local configuration if available
if-shell '[[ -e ~/.tmux.conf.local ]]' 'source-file ~/.tmux.conf.local'
